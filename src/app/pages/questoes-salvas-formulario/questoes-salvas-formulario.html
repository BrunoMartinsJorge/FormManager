<main>
  <div>
    <h1>Perguntas Salvas</h1>
    <p>Aqui você pode visualizar todas as perguntas salvas</p>
  </div>
  <p-table
    style="border: 1px solid #ccc;"
    [value]="listaPerguntasSalvas"
    stripedRows
    [rows]="8"
    [paginator]="true"
  >
    <ng-template pTemplate="caption">
      <p-button
        (click)="abrirDialogAdcionarPergunta()"
        label="Adicionar Nova Pergunta"
      />
    </ng-template>
    <ng-template pTemplate="header">
      <tr>
        <th>ID</th>
        <th>Título</th>
        <th>Tipo</th>
        <th style="text-align: center; width: 200px">Opções</th>
      </tr>
    </ng-template>
    <ng-template pTemplate="body" let-question>
      <tr>
        <td>{{ question.idPergunta }}</td>
        <td>
          @if (question.tipo !== 'IMAGEM') {
            {{ question.titulo }}
          } @else {
            {{ question.descricaoImagem }}
          }
        </td>
        <td>{{ question.tipo | typeQuestEnumTransform }}</td>
        <td
          style="
            display: flex;
            gap: 0.5em;
            justify-content: center;
            align-items: center;
          "
        >
          <p-splitbutton
            icon="pi pi-pencil"
            label="Editar"
            (onClick)="mudarVisibilidadeDialogEditarPergunta(question)"
            (onDropdownClick)="selecionarPergunta($event, question)"
            [model]="opcoesMenu"
            severity="primary"
          />
        </td>
      </tr>
    </ng-template>
    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="5">
          <span
            *ngIf="!carregandoPergunta && listaPerguntasSalvas.length === 0"
          >
            Nenhuma pergunta salva
          </span>
          <div
            *ngIf="carregandoPergunta"
            style="display: grid; place-items: center"
          >
            <p-progressSpinner></p-progressSpinner>
          </div>
        </td>
      </tr>
    </ng-template>
    <ng-template #footer>
      <tr>
        <td colspan="6">
          <span style="font-size: 14px; color: #333">
            Você possui {{ listaPerguntasSalvas ? listaPerguntasSalvas.length :
            0 }} perguntas salvas!
          </span>
        </td>
      </tr>
    </ng-template>
  </p-table>
</main>
<p-dialog
  [header]="modoDialog === 'edit' ? 'Editar Pergunta' : 'Novo modelo de pergunta'"
  [modal]="true"
  [style]="{'maxWidth': '600px', 'width': '100%'}"
  [draggable]="false"
  [(visible)]="visibilidadeAdicionarPergunta"
>
  <div class="quests-form">
    @if (novaPergunta.tipo !== 'IMAGEM') {
      <div class="input-group">
        <label for="titulo-quest">Título da Pergunta:</label>
        <input
        id="titulo-quest"
        type="text"
        pInputText
        [(ngModel)]="novaPergunta.titulo"
        placeholder="Título da Pergunta"
        />
      </div>
    }
    <div class="opcao-quest">
      <div class="input-group">
        <label for="tipo-quest">Qual o tipo da pergunta:</label>
        <p-select
          id="tipo-quest"
          [options]="tipoDeCampo"
          [(ngModel)]="novaPergunta.tipo"
          optionLabel="nome"
          optionValue="value"
          placeholder="Selecione o tipo de pergunta"
          appendTo="body"
        />
      </div>
      <p-button
        *ngIf="novaPergunta.tipo === 'MULTIPLA' || novaPergunta.tipo === 'UNICA'"
        label="Adicionar opção"
        icon="pi pi-plus"
        (click)="adicionarOpcao()"
      />
    </div>
    @if(novaPergunta.tipo === 'IMAGEM') {
    <div class="image-group">
      <div class="input-group">
        <label for="titulo-quest">Imagem da Pergunta:</label>
        <input
          id="titulo-quest"
          type="text"
          pInputText
          [(ngModel)]="novaPergunta.imagemUrl"
          placeholder="Imagem da Pergunta (URL)"
          [invalid]="!urlImagemValida(novaPergunta.imagemUrl || '') && (novaPergunta.imagemUrl || '').trim() !== ''"
          pTooltip="Opcional."
        />
      </div>
      <div class="input-group">
        <label for="titulo-quest">Descrição da Imagem:</label>
        <input
          id="titulo-quest"
          type="text"
          pInputText
          [(ngModel)]="novaPergunta.descricaoImagem"
          placeholder="Descrição da Imagem"
          [disabled]="!urlImagemValida(novaPergunta.imagemUrl || '')"
        />
      </div>
    </div>
    }
    <div
      class="inputs-list"
      *ngIf="novaPergunta.tipo && (novaPergunta.tipo === 'UNICA' || novaPergunta.tipo === 'MULTIPLA')"
    >
      <p-inputgroup
        pSize="small"
        *ngFor="let opcao of novaPergunta.opcoes; let index = index; trackBy: trackByIndex"
      >
        <p-button
          label="Apagar"
          icon="pi pi-trash"
          (click)="removerOpcao(index)"
        />
        <input
          pInputText
          placeholder="Opção..."
          [(ngModel)]="novaPergunta.opcoes![index]"
        />
      </p-inputgroup>
    </div>

    <div class="info-input" *ngIf="novaPergunta.tipo === 'ESCALA'">
      <div class="input-group">
        <label for="min-quest">Valor mínimo:</label>
        <p-input-number
          id="min-quest"
          type="number"
          [min]="0"
          [max]="novaPergunta.high ? novaPergunta.high : 2"
          [(ngModel)]="novaPergunta.low"
          placeholder="Valor mínimo"
        />
      </div>
      <div class="input-group">
        <label for="max-quest">Valor máximo:</label>
        <p-input-number
          id="max-quest"
          type="number"
          [min]="novaPergunta.low ? novaPergunta.low : 1"
          [(ngModel)]="novaPergunta.high"
          placeholder="Valor máximo"
        />
      </div>
    </div>
    <p-button
      [label]="modoDialog == 'edit' ? 'Editar Pergunta' : 'Adicionar Pergunta'"
      [style]="{ marginTop: '10px', width: '100%' }"
      icon="pi pi-check"
      (click)="modoDialog === 'edit' ? editarPerguntaSalva() : adicionarPergunta()"
      [disabled]="!perguntaValida()"
    /></div
></p-dialog>
