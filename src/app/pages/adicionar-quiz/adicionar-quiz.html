<section class="container">
  <div class="info-header">
    <h1>Adicionar Quiz</h1>
    <span>Crie um novo quiz com questões personalizadas.</span>
  </div>
  <div class="form-info">
    <span><i class="pi pi-calendar"></i>Informações do Quiz </span>
    <div class="quests-form">
      <div class="input-group">
        <label for="titulo">Título do Quiz:</label>
        <input
          id="titulo"
          type="text"
          pInputText
          [(ngModel)]="quiz.titulo"
          placeholder="Título do Quiz"
        />
      </div>
      <div class="input-group">
        <label for="descricao">Descrição do Quiz:</label>
        <textarea
          id="descricao"
          placeholder="Insira uma descrição para o quiz"
          rows="1"
          pTextarea
          [(ngModel)]="quiz.descricao"
        ></textarea>
      </div>
    </div>
  </div>
  <h2>Questões do Quiz</h2>
  <div class="quest" *ngFor="let questao of quiz.questoes; let i = index">
    <div class="quest-header">
      <h4>Questão {{ i + 1 }}</h4>
    </div>
    <hr />
    <div class="input-group">
      <label for="titulo-quest">Título da Questão:</label>
      <input
        id="titulo-quest"
        type="text"
        pInputText
        [(ngModel)]="questao.titulo"
        placeholder="Título da Questão"
      />
    </div>
    <div class="opcao-quest">
      <div class="input-group">
        <label for="tipo-quest">Qual o tipo da questão:</label>
        <p-select
          id="tipo-quest"
          [options]="tipoDeCampo"
          [(ngModel)]="questao.tipo"
          optionLabel="nome"
          optionValue="value"
          placeholder="Selecione o tipo de questão"
          class="w-full md:w-56"
        />
      </div>
      <p-button
        *ngIf="questao.tipo === 'MULTIPLA' || questao.tipo === 'UNICA'"
        label="Adicionar opção"
        icon="pi pi-plus"
        (click)="adicionarOpcao(i)"
      />
    </div>
    <div
      class="inputs-list"
      *ngIf="questao.tipo && (questao.tipo === 'UNICA' || questao.tipo === 'MULTIPLA')"
    >
      <p-inputgroup
        pSize="small"
        *ngFor="let opcao of questao.opcoes; let index = index; trackBy: trackByIndex"
      >
        <p-button
          label="Apagar"
          icon="pi pi-trash"
          (click)="removerOpcao(i, index)"
        />
        <input
          pInputText
          placeholder="Opção..."
          [(ngModel)]="questao.opcoes![index]"
        />
        <p-inputgroup-addon>
          <p-button
            [icon]="opcaoCorreta(i, index) ? 'pi pi-check' : 'pi pi-times'"
            (click)="toggleOpcaoCorreta(i, index)"
          />
        </p-inputgroup-addon>
      </p-inputgroup>
    </div>

    <div class="info-input" *ngIf="questao.tipo === 'ESCALA'">
      <div class="input-group">
        <label for="min-quest">Valor mínimo:</label>
        <p-input-number
          id="min-quest"
          type="number"
          [min]="0"
          [max]="questao.high ? questao.high : 2"
          [(ngModel)]="questao.low"
          placeholder="Valor mínimo"
        />
      </div>
      <div class="input-group">
        <label for="max-quest">Valor máximo:</label>
        <p-input-number
          id="max-quest"
          type="number"
          [min]="questao.low ? questao.low : 1"
          [(ngModel)]="questao.high"
          placeholder="Valor máximo"
        />
      </div>
    </div>
    <div
      class="inputs-list"
      *ngIf="questao.tipo && (questao.tipo === 'VERDADEIRO_FALSO')"
    >
      <p-inputgroup pSize="small">
        <input pInputText value="Verdadeiro" [disabled]="true" />
        <p-inputgroup-addon>
          <p-button
            [icon]="opcaoCorretaVerdadeiroFalse(i, 'Verdadeiro') ? 'pi pi-check' : 'pi pi-times'"
            (click)="toogleOpcaoCorretaVerdadeiroFalso(i, 'Verdadeiro')"
          />
        </p-inputgroup-addon>
      </p-inputgroup>
      <p-inputgroup pSize="small">
        <input pInputText value="Falso" [disabled]="true" />
        <p-inputgroup-addon>
          <p-button
            [icon]="opcaoCorretaVerdadeiroFalse(i, 'Falso') ? 'pi pi-check' : 'pi pi-times'"
            (click)="toogleOpcaoCorretaVerdadeiroFalso(i, 'Falso')"
          />
        </p-inputgroup-addon>
      </p-inputgroup>
    </div>
    <ng-container
      *ngIf="questao.tipo == 'UNICA' || questao.tipo == 'MULTIPLA' || questao.tipo == 'VERDADEIRO_FALSO'"
    >
      <div class="pontos-questao">
        <div class="input-group">
          <label for="pontos-quest">Pontos:</label>
          <p-input-number
            id="pontos-quest"
            type="number"
            [(ngModel)]="questao.pontos"
            placeholder="Pontos"
          />
        </div>
      </div>
      <div class="feedback">
        <div class="input-group">
          <label for="feedback-quest">Caso acerte:</label>
          <textarea
            id="feedback-quest"
            pInputTextarea
            [(ngModel)]="questao.feedbackCorreto"
            placeholder="Feedback"
          ></textarea>
        </div>
        <div class="input-group">
          <label for="feedback-quest">Caso erre:</label>
          <textarea
            id="feedback-quest"
            pInputTextarea
            [(ngModel)]="questao.feedbackErrado"
            placeholder="Feedback"
          ></textarea>
        </div>
      </div>
    </ng-container>
    <p-fieldset
      legend="Vizualizar questão"
      toggleable="true"
      [collapsed]="true"
      to
    >
      <app-visualizar-questao [questao]="questao"></app-visualizar-questao>
    </p-fieldset>
    <hr />
    <div class="footer-quest">
      <p-button
        label="Remover Questão"
        icon="pi pi-trash"
        severity="danger"
        (click)="removerQuestao(i)"
      />
    </div>
  </div>
  <div class="quest-empty" *ngIf="quiz.questoes.length === 0">
    <span>Nenhuma questão adicionada ainda.</span>
  </div>
</section>
<footer>
  <p-button
    label="Criar Quiz"
    (click)="criarQuiz()"
    [disabled]="!quizIsValid()"
    icon="pi pi-check"
  ></p-button>
  <p-splitbutton
    label="Adicionar Questão"
    class="ml-2"
    icon="pi pi-plus"
    (onClick)="adicionarQuestaoQuiz()"
    [model]="buttonOptions"
  />
</footer>
<section *ngIf="mostrarTelaAcao" class="tela-acao erro">
  <h2>Erro ao criar formulário</h2>
  <span> Aparentemente ocorreu um erro ao criar o formulário </span>
</section>
<section *ngIf="carregando" class="tela-acao carregando">
  <h2>Carregando...</h2>
  <span> Por favor, aguarde enquanto o formulário é criado </span>
  <p-progressSpinner></p-progressSpinner>
</section>
<p-dialog
  [style]="{ width: '50%' }"
  [(visible)]="visibilidadeDialog"
  header="Formulário criado com sucesso!"
  [modal]="true"
>
  <p-inputgroup>
    <p-button
      pTooltip="Copiar link"
      tooltipPosition="top"
      icon="pi pi-copy"
      severity="contrast"
      (click)="copyLink()"
    />
    <input
      pInputText
      placeholder="Link do formulário"
      [(ngModel)]="urlForm"
      [disabled]="true"
    />
  </p-inputgroup>
</p-dialog>
<p-dialog
  [style]="{ width: '50%' }"
  [(visible)]="visibilityQuestsSaved"
  header="Questões salvas"
  [modal]="true"
  [draggable]="false"
>
  <p-table
    [value]="questsSaved"
    [rows]="5"
    [paginator]="true"
    [responsiveLayout]="'scroll'"
    stripedRows
    showGridlines
  >
    <ng-template #header>
      <tr>
        <th>Questão</th>
        <th style="width: 75px; text-align: center">Utilizar?</th>
      </tr>
    </ng-template>
    <ng-template #body let-questao>
      <tr>
        <td>
          <app-visualizar-questao
            [questao]="questao"
            [buttonSendIsVisible]="false"
          ></app-visualizar-questao>
        </td>
        <td style="text-align: center">
          <p-checkbox
            [inputId]="'questao' + questao.id"
            [value]="questao"
            [(ngModel)]="questionsSelecteds"
            binary="false"
          ></p-checkbox>
        </td>
      </tr>
    </ng-template>
    <ng-template #emptymessage>
      <tr>
        <td colspan="2">Nenhuma questão salva ainda.</td>
      </tr>
    </ng-template>
    <ng-template #footer>
      <tr>
        <td colspan="2">
          <p-button
            icon="pi pi-plus"
            [label]="questionsSelecteds.length === 0 ? 'Selecione questões' : questionsSelecteds.length > 1 ? 'Adicionar questões' : 'Adicionar questão'"
            (click)="useQuestionsSelecteds()"
            [disabled]="questionsSelecteds.length === 0"
          ></p-button>
        </td>
      </tr>
    </ng-template>
  </p-table>
</p-dialog>
