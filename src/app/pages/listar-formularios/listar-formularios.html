<main class="page-content">
  <header class="header-page">
    <div class="info-header">
      <h1>Gerenciador de Formulários</h1>
      <p>Gerencie seus formulários do Google Forms de forma eficiente</p>
    </div>
    <p-button
      label="Novo Formulário"
      (click)="createNewForm()"
      icon="pi pi-plus"
      severity="contrast"
    />
  </header>
  <section class="forms-content">
    <div class="forms-list">
      <div class="fillter-form">
        <div class="input-group">
          <i class="pi pi-search"></i>
          <input
            type="text"
            placeholder="Filtrar formulários..."
            (input)="fillterForm($event.target)"
          />
        </div>
      </div>
      <div class="forms-grid">
        @for (form of formsList; track form.idFormulario) {
        <div
          [ngClass]="formSelectedId == form.idFormulario ? 'form-element selected' : 'form-element'"
          (click)="selectForm(form.idFormulario)"
        >
          <div class="header-form">
            <span>{{form.Titulo}}</span>
            <p>{{form.Descricao}}</p>
          </div>
          <div class="info-form">
            <span
              >Criado em {{form.Data_Criacao | date : 'dd/MM/yyyy HH:mm'}}</span
            >
            <span>ID: {{form.idFormulario}}</span>
          </div>
        </div>
        } @empty {
        <p>Nenhum formulário encontrado</p>
        }
      </div>
    </div>
    <div class="form-select">
      @if (loadingFormSelected && !formSelected){
      <div class="loading">
        <p-progressSpinner></p-progressSpinner>
        <span>Carregando formulário...</span>
      </div>
      } @else if (!formSelected && !loadingFormSelected) {
      <p
        style="
          display: flex;
          align-items: center;
          justify-content: center;
          text-align: center;
          flex: 1;
        "
      >
        Problemas ao carregar formulário
      </p>
      } @if (formSelected && !loadingFormSelected) {
      <div class="header-form-selected">
        <h3>{{getFormSelected.Titulo}}</h3>
        <span>{{getFormSelected.Descricao}}</span>
        <p>
          <span
            ><i class="pi pi-calendar"></i>Criado em
            {{getFormSelected.Data_Criacao | date : 'dd/MM/yyyy HH:mm'}}</span
          >
        </p>
        <div class="btn-list">
          <button (click)="toogleGeneratePDF($event)">
            <i class="pi pi-file-pdf"></i>
            Gerar PDF
          </button>
          <button (click)="exportFormToExcel()">
            <i class="pi pi-file-excel"></i>
            Gerar Excel
          </button>
          <button (click)="openForm()">
            <i class="pi pi-external-link"></i>
            Acessar Formulário
          </button>
          <button (click)="toogleCreateGraphics($event)">
            <i class="pi pi-chart-line"></i>
            Gerar Gráficos
          </button>
        </div>
      </div>
      <div class="body-form-selected">
        <div class="list-question-form">
          <div class="header-question-list">
            <h3>
              <i class="pi pi-list"></i>
              {{responsesOrQuestions != 'quest' ? 'Respostas do Formulário' :
              'Questões do Formulário'}}
            </h3>
            <p-button
              icon="pi pi-eye"
              [label]="responsesOrQuestions == 'responses' ? 'Ver Questões' : (formSelected.respostas.length > 0 ? 'Ver Respostas' : 'Nenhuma Resposta') "
              severity="contrast"
              [disabled]="formSelected == null || formSelected.respostas.length === 0"
              (click)="toogleResponseOrQuestions()"
            />
          </div>
          @if (responsesOrQuestions == 'quest') { @if (formSelected != null){
          @for (quest of formSelected.questoes; let i = $index; track quest.id)
          {
          <div class="quest-element">
            <div class="header-question">
              <strong>{{i+1}}º Questão - {{quest.titulo}}</strong>
              <span class="type-quest">{{quest.tipo}}</span>
            </div>
            <span class="responses">
              <i class="pi pi-eye"></i>
              Respostas - {{getNumberOfResponses(quest.id)}}
            </span>
          </div>
          } } } @if (responsesOrQuestions == 'responses') { @if (formSelected !=
          null){
          <section class="response-sends">
            <div class="header-response">
              <p-button
                icon="pi pi-angle-left"
                severity="secondary"
                [disabled]="indexByResponses === 0"
                (click)="previousResponse()"
              />
              <span
                ><i class="pi pi-user"></i>{{indexByResponses + 1}}ª - Resposta
                Individual</span
              >
              <p-button
                icon="pi pi-angle-right"
                severity="secondary"
                [disabled]="indexByResponses === responsesByUser.length - 1"
                (click)="nextResponse()"
              />
            </div>
            <div class="questions-list">
              @for(response of getResponseSelectedByIndex.respostas; let i =
              $index; track response.idResposta){
              <div class="response-quest-element">
                <div class="header-quest">
                  <strong
                    ><span class="quest-number">{{i + 1}}</span>
                    {{response.titulo}}</strong
                  >
                  <div class="type-quest">
                    {{getTypeQuestByIdQuestion(response.idQuestao)}}
                  </div>
                </div>
                <p>Resposta - {{response.valor}}</p>
              </div>
              }
            </div>
          </section>
          }}
        </div>
      </div>
      }
    </div>
  </section>
</main>
<app-gerar-graficos [formSelected]="formSelected" [(visibilityOfGenerateGraphic)]="visibilityOfGraphicCreate"></app-gerar-graficos>
<app-gerar-pdf [formSelected]="formPdfData" [(visibilityOfGeneratePDF)]="visibilityOfGeneratePDF"></app-gerar-pdf>
